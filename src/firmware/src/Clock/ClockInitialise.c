#include <xc.h>

#include "Clock.h"

#define T0CON0_POSTSCALE_15SECONDS_MASK (14 << _T0CON0_T0OUTPS_POSITION)

#define T0CON1_SOSC_SOURCE_MASK (0b110 << _T0CON1_T0CS_POSITION)
#define T0CON1_PRESCALE_1SECOND_MASK (0b1111 << _T0CON1_T0CKPS_POSITION)

void clockInitialise(void)
{
	T0CON0 = T0CON0_POSTSCALE_15SECONDS_MASK;
	OSCENbits.SOSCEN = 1;
	while (!OSCSTATbits.SOR)
		;;

	TMR0H = 1;
	TMR0L = 0;
	PIR0bits.TMR0IF = 0;
	PIE0bits.TMR0IE = 1;

	T0CON1 =
		_T0CON1_T0ASYNC_MASK |
		T0CON1_SOSC_SOURCE_MASK |
		T0CON1_PRESCALE_1SECOND_MASK;

	T0CON0bits.T0EN = 1;
}
